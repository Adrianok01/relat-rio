<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário com Áudio, Títulos e PDF</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        #formClienteTecnico {
            margin: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .input-campo, .input-select, .input-textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .titulo, .subtitulo {
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
        }

        .titulo input, .subtitulo input, .titulo textarea, .subtitulo textarea {
            margin-top: 10px;
            width: 100%;
        }

        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        button:hover {
            background-color: #0056b3;
        }

        .botao-finalizar {
            background-color: #28a745;
        }

        .botao-finalizar:hover {
            background-color: #218838;
        }

        .imagens-lado-a-lado {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-top: 10px;
        }

        .imagem-container {
            flex: 1;
            text-align: center;
            max-width: 48%;
            margin-bottom: 10px;
        }

        .imagem-container img {
            max-width: 100%;
            max-height: 800px;
        }

        #imprimirPdfBtn {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        #imprimirPdfBtn:hover {
            background-color: #c82333;
        }

        @media screen and (max-width: 768px) {
            .imagem-container {
                max-width: 100%;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div id="formClienteTecnico">
        <h2>Informações do Cliente e Técnico</h2>
        <div class="form-group">
            <label for="nomeCliente">Nome do Cliente:</label>
            <input type="text" id="nomeCliente" class="input-campo" placeholder="Nome do Cliente">
        </div>
        <div class="form-group">
            <label for="nomeTecnico">Nome do Técnico:</label>
            <input type="text" id="nomeTecnico" class="input-campo" placeholder="Nome do Técnico">
        </div>
        <div class="form-group">
            <label for="pressao">Pressão:</label>
            <input type="text" id="pressao" class="input-campo" placeholder="Pressão">
        </div>
        <div class="form-group">
            <label for="modelo">Modelo:</label>
            <input type="text" id="modelo" class="input-campo" placeholder="Modelo">
        </div>
        <div class="form-group">
            <label for="numero">Número:</label>
            <input type="text" id="numero" class="input-campo" placeholder="Número">
        </div>
        <div class="form-group">
            <label for="sat">SAT:</label>
            <input type="text" id="sat" class="input-campo" placeholder="SAT">
        </div>
        <div class="form-group">
            <label for="of">OF:</label>
            <input type="text" id="of" class="input-campo" placeholder="OF">
        </div>
    </div>

    <div class="form-group">
        <label for="classe">Escolha uma Classe:</label>
        <select id="classe" name="classe" class="input-select" onchange="atualizarTitulo()">
            <option value="0">Classe 1</option>
            <option value="1">Classe 2</option>
            <option value="2">Classe 3</option>
            <option value="3">Classe 4</option>
            <option value="4">Classe 5</option>
            <option value="5">Classe 6</option>
            <option value="6">Classe 7</option>
            <option value="7">Classe 8</option>
            <option value="8">Classe 9</option>
            <option value="9">Classe 10</option>
        </select>
    </div>

    <div id="campoTitulo"></div>

    <button id="imprimirPdfBtn">Imprimir em PDF</button>

    <button id="enviarDadosBtn">Enviar ao Banco de Dados</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const titulos = [
            "Título da Classe 1",
            "Título da Classe 2",
            "Título da Classe 3",
            "Título da Classe 4",
            "Título da Classe 5",
            "Título da Classe 6",
            "Título da Classe 7",
            "Título da Classe 8",
            "Título da Classe 9",
            "Título da Classe 10"
        ];

        function atualizarTitulo() {
            const classeSelecionada = document.getElementById('classe').value;
            const campoTitulo = document.getElementById('campoTitulo');
            
            // Criar o título para a classe selecionada
            const divTitulo = document.createElement('div');
            divTitulo.classList.add('form-group');
            divTitulo.classList.add('titulo');
            divTitulo.id = `titulo${classeSelecionada}`;

            const label = document.createElement('label');
            label.setAttribute('for', `titulo${classeSelecionada}`);
            label.innerText = `Título:`;

            const input = document.createElement('input');
            input.type = 'text';
            input.id = `titulo${classeSelecionada}`;
            input.name = `titulo${classeSelecionada}`;
            input.value = titulos[classeSelecionada];

            const gravarAudioBtn = document.createElement('button');
            gravarAudioBtn.innerText = 'Gravar Áudio';
            gravarAudioBtn.onclick = function() {
                iniciarGravacao(classeSelecionada); 
            };

            const finalizarGravacaoBtn = document.createElement('button');
            finalizarGravacaoBtn.innerText = 'Finalizar Gravação';
            finalizarGravacaoBtn.classList.add('botao-finalizar');
            finalizarGravacaoBtn.onclick = function() {
                finalizarGravacao(classeSelecionada); 
            };

            const transcricao = document.createElement('textarea');
            transcricao.id = `transcricao-${classeSelecionada}`;
            transcricao.style.marginTop = '10px';
            transcricao.value = 'Nenhum áudio gravado'; 
            transcricao.setAttribute('rows', '3');
            transcricao.setAttribute('placeholder', 'Edite a transcrição aqui...');

            const imagensLadoALado = document.createElement('div');
            imagensLadoALado.classList.add('imagens-lado-a-lado');

            const imagem1Container = document.createElement('div');
            imagem1Container.classList.add('imagem-container');
            const imagem1Input = document.createElement('input');
            imagem1Input.type = 'file';
            imagem1Input.accept = 'image/*';
            imagem1Input.onchange = function() {
                previewImagem(imagem1Input, imagem1Container);
            };
            imagem1Container.appendChild(imagem1Input);

            const imagem2Container = document.createElement('div');
            imagem2Container.classList.add('imagem-container');
            const imagem2Input = document.createElement('input');
            imagem2Input.type = 'file';
            imagem2Input.accept = 'image/*';
            imagem2Input.onchange = function() {
                previewImagem(imagem2Input, imagem2Container);
            };
            imagem2Container.appendChild(imagem2Input);

            imagensLadoALado.appendChild(imagem1Container);
            imagensLadoALado.appendChild(imagem2Container);

            // Adicionando os subtítulos fixos
            for (let i = 1; i <= 5; i++) {
                adicionarSubtitulo(divTitulo, classeSelecionada, i); 
            }

            divTitulo.appendChild(label);
            divTitulo.appendChild(input);
            divTitulo.appendChild(gravarAudioBtn);
            divTitulo.appendChild(finalizarGravacaoBtn);
            divTitulo.appendChild(transcricao);
            divTitulo.appendChild(imagensLadoALado);

            campoTitulo.appendChild(divTitulo);
        }

        function adicionarSubtitulo(tituloDiv, tituloIndex, subtituloIndex) {
            const subtituloDiv = document.createElement('div');
            subtituloDiv.classList.add('form-group');
            subtituloDiv.classList.add('subtitulo');

            const label = document.createElement('label');
            label.innerText = `Subtítulo ${subtituloIndex} de Título:`;

            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `Digite o subtítulo ${subtituloIndex} aqui...`;

            const gravarAudioBtn = document.createElement('button');
            gravarAudioBtn.innerText = 'Gravar Áudio';
            gravarAudioBtn.onclick = function() {
                iniciarGravacao(`${tituloIndex}-${subtituloIndex}`); 
            };

            const finalizarGravacaoBtn = document.createElement('button');
            finalizarGravacaoBtn.innerText = 'Finalizar Gravação';
            finalizarGravacaoBtn.classList.add('botao-finalizar');
            finalizarGravacaoBtn.onclick = function() {
                finalizarGravacao(`${tituloIndex}-${subtituloIndex}`); 
            };

            const transcricao = document.createElement('textarea');
            transcricao.style.marginTop = '10px';
            transcricao.value = 'Nenhum áudio gravado'; 
            transcricao.setAttribute('rows', '3');
            transcricao.setAttribute('placeholder', `Edite a transcrição do subtítulo ${subtituloIndex} aqui...`);

            const imagensLadoALado = document.createElement('div');
            imagensLadoALado.classList.add('imagens-lado-a-lado');

            const imagem1Container = document.createElement('div');
            imagem1Container.classList.add('imagem-container');
            const imagem1Input = document.createElement('input');
            imagem1Input.type = 'file';
            imagem1Input.accept = 'image/*';
            imagem1Input.onchange = function() {
                previewImagem(imagem1Input, imagem1Container);
            };
            imagem1Container.appendChild(imagem1Input);

            const imagem2Container = document.createElement('div');
            imagem2Container.classList.add('imagem-container');
            const imagem2Input = document.createElement('input');
            imagem2Input.type = 'file';
            imagem2Input.accept = 'image/*';
            imagem2Input.onchange = function() {
                previewImagem(imagem2Input, imagem2Container);
            };
            imagem2Container.appendChild(imagem2Input);

            imagensLadoALado.appendChild(imagem1Container);
            imagensLadoALado.appendChild(imagem2Container);

            subtituloDiv.appendChild(label);
            subtituloDiv.appendChild(input);
            subtituloDiv.appendChild(gravarAudioBtn);
            subtituloDiv.appendChild(finalizarGravacaoBtn);
            subtituloDiv.appendChild(transcricao);
            subtituloDiv.appendChild(imagensLadoALado);

            tituloDiv.appendChild(subtituloDiv);
        }

        function iniciarGravacao(identificador) {
            console.log("Iniciar gravação para", identificador);
        }

        function finalizarGravacao(identificador) {
            console.log("Finalizar gravação para", identificador);
        }

        function previewImagem(input, container) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                container.appendChild(img);
            };
            reader.readAsDataURL(input.files[0]);
        }

        document.getElementById('enviarDadosBtn').addEventListener('click', function() {
            const dados = {
                nomeCliente: document.getElementById('nomeCliente').value,
                nomeTecnico: document.getElementById('nomeTecnico').value,
                pressao: document.getElementById('pressao').value,
                modelo: document.getElementById('modelo').value,
                numero: document.getElementById('numero').value,
                sat: document.getElementById('sat').value,
                of: document.getElementById('of').value,
                classe: document.getElementById('classe').value,
                titulos: [], // Pega os títulos do DOM
                subtitulos: [] // Pega os subtítulos do DOM
            };
            
            // Pega os títulos e subtítulos
            for (let i = 0; i <= 9; i++) {
                const titulo = document.getElementById(`titulo${i}`);
                if (titulo) {
                    dados.titulos.push(titulo.value);
                }

                const subtitulos = document.querySelectorAll(`#titulo${i} .subtitulo input`);
                subtitulos.forEach((subtituloInput) => {
                    dados.subtitulos.push(subtituloInput.value);
                });
            }

            fetch('http://localhost/meu-projeto/backend/processar_formulario.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                alert("Dados enviados com sucesso!");
            })
            .catch(error => {
                console.error("Erro ao enviar os dados", error);
            });
        });
    </script>

</body>
</html>
